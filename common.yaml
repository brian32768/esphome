wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  manual_ip:
    static_ip: ${static_ip}
    gateway: 192.168.123.1
    subnet: 255.255.255.0
  fast_connect: on

# Enable fallback hotspot (captive portal) in case wifi connection fails
#  ap:
#    ssid: ${devicename} hotspot
#    password: !secret wifi_password

# Enable over-the-air updates
ota:

# Don't need a web server right now
#web_server:

# Enable Home Assistant API
# I need this to get the time from Home Assistant
api:

# or
# Enable mqtt
mqtt:
    broker: 192.168.123.2
    discovery: true
    discovery_prefix: homeassistant
# 2021-10-10 not working in mosquitto
#    username: homeassistant
#    password: u89adsjr3

logger:

captive_portal:

sensor:
- platform: uptime
  name: ${upper_devicename} Uptime
  id: uptime_sensor
  update_interval: 60s
  on_raw_value:
    then:
      - text_sensor.template.publish:
          id: uptime_human
          state: !lambda |-
            int seconds = round(id(uptime_sensor).raw_state);
            int days = seconds / (24 * 3600);
            seconds = seconds % (24 * 3600);
            int hours = seconds / 3600;
            seconds = seconds % 3600;
            int minutes = seconds /  60;
            seconds = seconds % 60;
            return (
              (days ? to_string(days) + "d " : "") +
              (hours ? to_string(hours) + "h " : "") +
              (minutes ? to_string(minutes) + "m " : "") +
              (to_string(seconds) + "s")
            ).c_str();

- platform: wifi_signal
  name: ${upper_device_name} WiFi Signal
  update_interval: 60s
